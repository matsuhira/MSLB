# MSLBについて

## MSLBとは

MSLBは、Multi-Stage Transparent Server Load Balancingの略で、プロトコルに依存しない負荷分散技術です。<br>

既存の良く知られる負荷分散技術のひとつに、IPパケットの宛先アドレスを書き換えることにより実現する方式があります。<br>
IPヘッダのアドレスを書き換えることで良く知られる技術に、NATやNAPTがありますが、これらの技術には、
データ部でIPアドレスを運ぶようなアプリケーションへの対応の課題があることが良く知られています。
宛先アドレスを書き換える、負荷分散技術にも同様の課題があります。なお、NATは、送信元アドレスを書き換えますので、
書き換える対象は異なりますが、IPアドレスを書き換える点では同様です。<br>

MSLBは、このようなアプリケーション依存性を解消し、汎用的に負荷分散を実現できることを狙いにしています。もちろん、IPv4/IPv6に同じ仕組みで対応しています。<br>

## MSLBの仕組み

MSLBは上記の課題を、多段で処理することにより解決しています。<br>

初段では、従来と同様に、宛先アドレスを変換します。MSLBでは、最終段を設け、ここで、書き換えた宛先アドレスを書き換え前のアドレスに書き換えます。
その後、パケットはサーバに渡されますが、このパケットは、初段が受信したパケットと全く同じパケットになります。
この結果、IPヘッダのIPアドレス情報と、データ部に含まれるIPアドレス情報の間の不整合を無くします。クライアントからもサーバからも負荷分散装置の存在は見えません。<br>


## MSLBの構成

既存の負荷分散技術では、戻りのIPパケットを対象に、今度は、発信元アドレスを書き換える処理が必要になります。
この結果、サーバに向かうIPパケットと、戻りのパケットの全てが、この負荷分散装置を通過する必要が生じ、
この負荷分散装置の性能が、性能的なボトルネックになります。<br>

MSLBは、初段処理をone armで実現することが可能です。このような構成を取ることにより、サーバからクライアントへの返信が、初段装置を通過する必要が無くなります。
この結果、性能的なボトルネックが緩和されます。




